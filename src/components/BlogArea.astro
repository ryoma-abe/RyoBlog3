---
import { getCollection } from "astro:content";

// コンテンツコレクションからブログ記事を取得
const blogPosts = await getCollection("blog", ({ data }) => {
  // 下書き記事を本番環境では除外（任意）
  return import.meta.env.PROD ? !data.draft : true;
});

// 日付でソート（新しい順）
const sortedPosts = blogPosts.sort((a, b) => {
  const dateA = new Date(a.data.date || "");
  const dateB = new Date(b.data.date || "");
  return dateB.getTime() - dateA.getTime();
});

// タグごとの背景色を設定
const tagColors = {
  "フロントエンド": "bg-blue-500",
  "バックエンド": "bg-green-500",
  "デザイン": "bg-purple-500",
  "AI": "bg-purple-400",
  "キャリア": "bg-amber-500",
  "その他": "bg-gray-500" // デフォルト
};

// 日付をフォーマットする関数
function formatDate(dateString) {
  if (!dateString) return "";
  const date = new Date(dateString);
  return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
}
---

<!-- 記事グリッド -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
  {sortedPosts.map(post => {
    const mainTag = post.data.tags && post.data.tags.length > 0 ? post.data.tags[0] : "その他";
    const bgColor = tagColors[mainTag] || tagColors["その他"];
    return (
      <div class="bg-slate-800 rounded-lg overflow-hidden shadow-lg transition-transform hover:scale-105">
        <div class={`${bgColor} h-48 p-6 flex items-center justify-center text-white text-center`}>
          <h3 class="text-xl font-bold">{post.data.title}</h3>
        </div>
        <div class="p-4">
          <div class="flex justify-between items-center mb-2">
            <span class={`text-sm px-3 py-1 rounded-full ${bgColor} text-white`}>
              {mainTag}
            </span>
            <span class="text-sm text-gray-400">{formatDate(post.data.date)}</span>
          </div>
          {post.data.description && (
            <p class="text-gray-300 text-sm mb-4">{post.data.description}</p>
          )}
          <a 
            href={`/${post.slug}`}
            class="block w-full text-center py-2 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors text-white"
          >
            記事を読む
          </a>
        </div>
      </div>
    );
  })}
</div>