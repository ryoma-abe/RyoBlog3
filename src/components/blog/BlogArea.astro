---
import { getAllPosts, getSlugFromId } from "../../lib/utils/posts";
import { getTagColor } from "../../lib/utils/tags";
import { formatDate } from "../../lib/utils/utils";

// 記事データを取得
const allPosts = await getAllPosts();
const sortedPosts = allPosts.slice(0, 6); // トップページには最新6件のみ表示
---

<div class="grid grid-auto-300 gap-8">
  {
    sortedPosts.length > 0 ? (
      sortedPosts.map((post) => {
        const { title, tags, date, description } = post.data;
        const slug = getSlugFromId(post.id);
        const tag = Array.isArray(tags) && tags.length > 0 ? tags[0] : "その他";

        return (
          <div class="border-primary rounded-lg transition duration-300 hover:scale-102 hover:shadow-lg">
            <a href={`/${slug}`} class="block">
              <div
                class={`h-48 flex items-center justify-center text-white text-center rounded-t-lg ${getTagColor(tag)}`}
              >
                <p class="text-xl font-bold px-4">{title}</p>
              </div>
              <div class="px-6 py-6">
                <div class="flex justify-between items-center">
                  <div class="flex gap-2 flex-wrap">
                    {Array.isArray(tags) && tags.length > 0 ? (
                      tags.map((tag) => (
                        <span
                          class={`text-sm px-3 py-1 rounded-full ${getTagColor(tag)} text-white`}
                        >
                          {tag}
                        </span>
                      ))
                    ) : (
                      <span class="text-sm px-3 py-1 rounded-full bg-gray-500 text-white">
                        その他
                      </span>
                    )}
                  </div>
                  <p class="text-primary text-sm">
                    {formatDate(
                      date instanceof Date ? date.toISOString() : String(date)
                    )}
                  </p>
                </div>
                {description && <p class="mt-4 text-gray-600">{description}</p>}
                <h2 class="mt-5">{title}</h2>
              </div>
            </a>
          </div>
        );
      })
    ) : (
      <div class="col-span-full text-center py-10">
        <p class="text-xl text-gray-500">記事がありません</p>
      </div>
    )
  }
</div>

<div class="flex justify-center mt-8">
  <a
    href="/blog/page/1"
    class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition"
  >
    すべての記事を見る
  </a>
</div>
